<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics & Reports - AI Testing Platform</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        :root {
            --primary: #52b788;
            --primary-dark: #1b4332;
            --primary-soft: #b7e4c7;
            --bg-body: #f7fffb;
            --text-main: #2d6a4f;
            --text-muted: #6b9080;
            --glass-white: rgba(255, 255, 255, 0.8);
            --border-soft: rgba(82, 183, 136, 0.15);
            --success: #40916c;
            --danger: #d62828;
            --sidebar-width: 280px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Plus Jakarta Sans', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f0fdf4 0%, #d1fae5 100%);
            color: var(--text-main);
            min-height: 100vh;
            display: flex;
        }

        /* ===== NAVBAR ===== */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 70px;
            background: linear-gradient(135deg, #0f172a 0%, #1b4332 50%, #2d6a4f 100%);
            border-bottom: 2px solid rgba(82, 183, 136, 0.3);
            display: flex;
            align-items: center;
            padding: 0 2rem;
            gap: 2rem;
            box-shadow: 0 10px 30px rgba(27, 67, 50, 0.15);
            z-index: 100;
        }

        .navbar-brand {
            color: white;
            font-size: 1.3rem;
            font-weight: 900;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .navbar-brand i {
            color: var(--primary);
            font-size: 1.5rem;
        }

        .navbar-title {
            color: white;
            font-weight: 700;
            flex: 1;
        }

        /* ===== SIDEBAR ===== */
        .sidebar {
            width: var(--sidebar-width);
            height: 100vh;
            background: linear-gradient(180deg, #f8fafb 0%, #f0fdf4 100%);
            border-right: 2px solid rgba(82, 183, 136, 0.2);
            position: fixed;
            display: flex;
            flex-direction: column;
            box-shadow: 0 10px 30px rgba(27, 67, 50, 0.08);
            top: 70px;
            margin-top: 0;
        }

        .sidebar-brand {
            padding: 2rem 1.5rem;
            font-size: 1.2rem;
            font-weight: 900;
            color: var(--primary-dark);
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 2px solid rgba(82, 183, 136, 0.2);
        }

        .sidebar-brand i {
            font-size: 1.4rem;
            color: var(--primary);
        }

        .sidebar-menu {
            flex: 1;
            padding: 1.5rem 0.8rem;
            overflow-y: auto;
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 1rem 1.2rem;
            color: var(--text-muted);
            text-decoration: none;
            border-radius: 12px;
            margin-bottom: 0.5rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 700;
            font-size: 0.95rem;
        }

        .menu-item i {
            margin-right: 12px;
            width: 20px;
            text-align: center;
            font-size: 1.1rem;
        }

        .menu-item:hover {
            background: linear-gradient(135deg, rgba(82, 183, 136, 0.15), rgba(82, 183, 136, 0.08));
            color: var(--primary);
            transform: translateX(8px);
            box-shadow: 0 4px 12px rgba(82, 183, 136, 0.1);
        }

        .menu-item.active {
            background: linear-gradient(135deg, var(--primary), var(--success));
            color: white;
            box-shadow: 0 8px 20px rgba(82, 183, 136, 0.2);
            font-weight: 800;
        }

        .sidebar-footer {
            padding: 1rem 0.8rem;
            border-top: 1px solid var(--border-soft);
        }

        .btn-logout {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            background: linear-gradient(135deg, var(--primary), var(--success));
            border: none;
            color: white;
            padding: 1rem 1.2rem;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.3s;
            box-shadow: 0 8px 20px rgba(82, 183, 136, 0.2);
        }

        .btn-logout:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 30px rgba(82, 183, 136, 0.3);
        }

        .btn-logout i {
            font-size: 1.1rem;
        }

        /* ===== MAIN CONTENT ===== */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            margin-top: 70px;
            padding: 2rem;
        }

        /* ===== HEADER ===== */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .page-title {
            font-size: 2.2rem;
            font-weight: 900;
            color: var(--primary-dark);
        }

        .page-subtitle {
            color: var(--text-muted);
            font-size: 0.95rem;
            margin-top: 0.5rem;
            font-weight: 600;
        }

        /* ===== CARDS ===== */
        .card-glass {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(240, 253, 244, 0.9) 100%);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(82, 183, 136, 0.25);
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 10px 30px rgba(27, 67, 50, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.5);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .card-glass::after {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(82, 183, 136, 0.05) 0%, transparent 70%);
            pointer-events: none;
        }

        .card-glass:hover {
            transform: translateY(-6px) scale(1.01);
            box-shadow: 0 20px 40px rgba(82, 183, 136, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.8);
            border-color: rgba(82, 183, 136, 0.4);
            background: linear-gradient(135deg, white 0%, rgba(240, 253, 244, 0.95) 100%);
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(240, 253, 244, 0.9) 100%);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(82, 183, 136, 0.25);
            border-radius: 16px;
            padding: 1.5rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 10px 30px rgba(27, 67, 50, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.5);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--success), transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-6px) scale(1.02);
            background: white;
            border-color: rgba(82, 183, 136, 0.5);
            box-shadow: 0 20px 40px rgba(82, 183, 136, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.8);
        }

        .stat-card:hover::before {
            opacity: 1;
        }

        .stat-value {
            font-size: 2.2rem;
            font-weight: 900;
            color: var(--primary);
            margin-top: 0.5rem;
            background: linear-gradient(135deg, var(--primary), var(--success));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            color: var(--text-muted);
            font-size: 0.75rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1.2px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .stat-description {
            color: var(--text-muted);
            font-size: 0.85rem;
            margin-top: 0.5rem;
            font-weight: 500;
        }

        /* ===== CHARTS ===== */
        .chart-container {
            position: relative;
            height: 280px;
            margin-top: 1rem;
        }

        /* ===== BUTTONS ===== */
        .btn-primary {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 13px 26px;
            background: linear-gradient(135deg, var(--primary), var(--success));
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 800;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 8px 20px rgba(82, 183, 136, 0.25);
            font-size: 0.95rem;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(82, 183, 136, 0.35);
        }

        .btn-primary:active {
            transform: translateY(-1px);
        }

        /* ===== TABLES ===== */
        .table-row-hover:hover {
            background: rgba(82, 183, 136, 0.1);
            transform: translateX(4px);
        }

        /* ===== ANIMATIONS ===== */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in-up {
            animation: fadeInUp 0.6s ease-out forwards;
        }

        /* ===== ADDITIONAL ANIMATIONS ===== */
        @keyframes slideInLeft {
            from { opacity: 0; transform: translateX(-30px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .animate-slideIn { animation: slideInLeft 0.5s ease-out; }

        @keyframes shimmer {
            0% { background-position: -1000px 0; }
            100% { background-position: 1000px 0; }
        }

        @keyframes pulse-ring {
            0% { box-shadow: 0 0 0 0 rgba(82, 183, 136, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(82, 183, 136, 0); }
            100% { box-shadow: 0 0 0 0 rgba(82, 183, 136, 0); }
        }

        .pulse-ring { animation: pulse-ring 2s infinite; }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 1024px) {
            .sidebar {
                width: 200px;
            }

            .main-content {
                margin-left: 200px;
                padding: 1.5rem;
            }

            .page-title {
                font-size: 1.5rem;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
                border-right: none;
                border-bottom: 1px solid var(--border-soft);
                flex-direction: row;
                align-items: center;
                padding: 1rem;
                margin-bottom: 1rem;
            }

            .sidebar-brand {
                padding: 0;
                border: none;
                margin-bottom: 0;
            }

            .sidebar-menu {
                display: none;
            }

            .main-content {
                margin-left: 0;
                padding: 1rem;
            }

            .page-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="navbar-brand">
            <i class="fas fa-chart-line"></i>
            <span>AI-TestLab</span>
        </div>
        <div class="navbar-title">üìä Analytics & Reports</div>
        <div style="color: white; font-weight: 700; font-size: 0.9rem;">
            <i class="far fa-user-circle" style="font-size: 1.5rem; margin-right: 10px;"></i>
        </div>
    </nav>

    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-brand">
            <i class="fas fa-chart-bar"></i> Analytics
        </div>
        <nav class="sidebar-menu">
            <a href="dashboard.html" class="menu-item">
                <i class="fas fa-home"></i> T·ªïng quan
            </a>
            <a href="test-creation.html" class="menu-item">
                <i class="fas fa-pen"></i> T·∫°o Test Case
            </a>
            <a href="analytics.html" class="menu-item active">
                <i class="fas fa-chart-line"></i> Analytics
            </a>
            <a href="website-analyzer.html" class="menu-item">
                <i class="fas fa-globe"></i> Website Analyzer
            </a>
            <a href="script-review.html" class="menu-item">
                <i class="fas fa-code"></i> Script Review
            </a>
        </nav>
        <div class="sidebar-footer">
            <button class="btn-logout" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Page Header -->
        <div class="page-header">
            <div>
                <h1 class="page-title">Analytics & Reports</h1>
                <p class="page-subtitle">Ph√¢n t√≠ch chi ti·∫øt hi·ªáu su·∫•t test</p>
            </div>
        </div>

        <!-- Loading State -->
        <div id="loadingState" class="flex items-center justify-center py-20">
            <div class="text-center">
                <div class="inline-block">
                    <div class="w-20 h-20 rounded-full border-4 border-emerald-200 border-t-emerald-600 animate-spin"></div>
                </div>
                <p class="text-gray-600 mt-6 text-lg">ƒêang t·∫£i d·ªØ li·ªáu ph√¢n t√≠ch...</p>
            </div>
        </div>

        <!-- Content -->
        <div id="analyticsContent" class="hidden">
            <!-- Summary Cards -->
            <div style="margin-bottom: 2.5rem;">
                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 1.5rem;">
                    <div style="width: 4px; height: 28px; background: linear-gradient(180deg, var(--primary), var(--success)); border-radius: 2px;"></div>
                    <h2 style="font-size: 1.6rem; font-weight: 900; color: var(--primary-dark);">T√≥m t·∫Øt Hi·ªáu su·∫•t</h2>
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem;">
                    <div class="stat-card fade-in-up">
                        <div style="display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span class="stat-label"><i class="fas fa-flask" style="color: #3b82f6;"></i> T·ªîNG TEST</span>
                            <div style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(59, 130, 246, 0.1)); border: 1px solid rgba(59, 130, 246, 0.3); padding: 4px 10px; border-radius: 20px; font-size: 0.7rem; font-weight: 700; color: #3b82f6; text-transform: uppercase;">All Cases</div>
                        </div>
                        <div class="stat-value" id="totalTests">0</div>
                        <p class="stat-description">T·ªïng s·ªë test case ƒë∆∞·ª£c t·∫°o</p>
                    </div>

                    <div class="stat-card fade-in-up">
                        <div style="display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span class="stat-label"><i class="fas fa-check-circle" style="color: #22c55e;"></i> PASSED</span>
                            <div style="background: linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(34, 197, 94, 0.1)); border: 1px solid rgba(34, 197, 94, 0.3); padding: 4px 10px; border-radius: 20px; font-size: 0.7rem; font-weight: 700; color: #22c55e; text-transform: uppercase;">Success</div>
                        </div>
                        <div class="stat-value" style="background: linear-gradient(135deg, #22c55e, #16a34a); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;" id="passedSteps">0</div>
                        <p class="stat-description">Test th√†nh c√¥ng ‚úì</p>
                    </div>

                    <div class="stat-card fade-in-up">
                        <div style="display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span class="stat-label"><i class="fas fa-times-circle" style="color: #ef4444;"></i> FAILED</span>
                            <div style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(239, 68, 68, 0.1)); border: 1px solid rgba(239, 68, 68, 0.3); padding: 4px 10px; border-radius: 20px; font-size: 0.7rem; font-weight: 700; color: #ef4444; text-transform: uppercase;">Alert</div>
                        </div>
                        <div class="stat-value" style="background: linear-gradient(135deg, #ef4444, #dc2626); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;" id="failedSteps">0</div>
                        <p class="stat-description">Test th·∫•t b·∫°i ‚úï</p>
                    </div>

                    <div class="stat-card fade-in-up">
                        <div style="display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span class="stat-label"><i class="fas fa-circle-notch" style="color: #eab308;"></i> PENDING</span>
                            <div style="background: linear-gradient(135deg, rgba(234, 179, 8, 0.2), rgba(234, 179, 8, 0.1)); border: 1px solid rgba(234, 179, 8, 0.3); padding: 4px 10px; border-radius: 20px; font-size: 0.7rem; font-weight: 700; color: #eab308; text-transform: uppercase;">Waiting</div>
                        </div>
                        <div class="stat-value" style="background: linear-gradient(135deg, #eab308, #ca8a04); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;" id="pendingSteps">0</div>
                        <p class="stat-description">ƒêang ch·ªù x·ª≠ l√Ω ‚è≥</p>
                    </div>

                    <div class="stat-card fade-in-up">
                        <div style="display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span class="stat-label"><i class="fas fa-chart-pie" style="color: #a855f7;"></i> PASS RATE</span>
                            <div style="background: linear-gradient(135deg, rgba(168, 85, 247, 0.2), rgba(168, 85, 247, 0.1)); border: 1px solid rgba(168, 85, 247, 0.3); padding: 4px 10px; border-radius: 20px; font-size: 0.7rem; font-weight: 700; color: #a855f7; text-transform: uppercase;">KPI</div>
                        </div>
                        <div class="stat-value" style="background: linear-gradient(135deg, #a855f7, #9333ea); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;" id="passRate">0%</div>
                        <p class="stat-description">T·ª∑ l·ªá test th√†nh c√¥ng</p>
                        <div style="margin-top: 0.75rem; background: rgba(168, 85, 247, 0.1); height: 4px; border-radius: 2px; overflow: hidden;">
                            <div id="passRateBar" style="width: 0%; height: 100%; background: linear-gradient(90deg, #a855f7, #9333ea); transition: width 0.6s ease; border-radius: 2px;"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts Row 1 -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                <!-- Pass/Fail Chart -->
                <div class="card-glass">
                    <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1.5rem;">
                        <div style="width: 40px; height: 40px; background: linear-gradient(135deg, var(--primary), var(--success)); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-chart-pie" style="color: white; font-size: 1rem;"></i>
                        </div>
                        <div>
                            <h3 style="font-size: 1.1rem; font-weight: 700; color: var(--text-main);">Test Results Distribution</h3>
                            <p style="font-size: 0.85rem; color: var(--text-muted);">Ph√¢n b·ªï k·∫øt qu·∫£ test</p>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="passFailChart"></canvas>
                    </div>
                </div>

                <!-- By Priority -->
                <div class="card-glass">
                    <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1.5rem;">
                        <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #f97316, #ea580c); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-bars" style="color: white; font-size: 1rem;"></i>
                        </div>
                        <div>
                            <h3 style="font-size: 1.1rem; font-weight: 700; color: var(--text-main);">Test Cases by Priority</h3>
                            <p style="font-size: 0.85rem; color: var(--text-muted);">Theo m·ª©c ƒë·ªô ∆∞u ti√™n</p>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="priorityChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Charts Row 2 -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                <!-- By Module -->
                <div class="card-glass">
                    <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1.5rem;">
                        <div style="width: 40px; height: 40px; background: linear-gradient(135deg, var(--primary), var(--success)); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-cubes" style="color: white; font-size: 1rem;"></i>
                        </div>
                        <div>
                            <h3 style="font-size: 1.1rem; font-weight: 700; color: var(--text-main);">Test Cases by Module</h3>
                            <p style="font-size: 0.85rem; color: var(--text-muted);">Ph√¢n b·ªï theo module</p>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="moduleChart"></canvas>
                    </div>
                </div>

                <!-- By Type -->
                <div class="card-glass">
                    <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1.5rem;">
                        <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #818cf8, #6366f1); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-project-diagram" style="color: white; font-size: 1rem;"></i>
                        </div>
                        <div>
                            <h3 style="font-size: 1.1rem; font-weight: 700; color: var(--text-main);">Test Cases by Type</h3>
                            <p style="font-size: 0.85rem; color: var(--text-muted);">Theo lo·∫°i test</p>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="typeChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Detailed Tables -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                <!-- Module Details -->
                <div class="card-glass">
                    <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1.5rem;">
                        <i class="fas fa-list" style="color: var(--primary); font-size: 1.2rem;"></i>
                        <h3 style="font-size: 1.1rem; font-weight: 700; color: var(--text-main);">Chi ti·∫øt theo Module</h3>
                    </div>
                    <div style="overflow-x: auto;">
                        <table style="width: 100%; font-size: 0.9rem; border-collapse: collapse;">
                            <thead>
                                <tr style="border-bottom: 2px solid rgba(82, 183, 136, 0.2);">
                                    <th style="text-align: left; padding: 0.75rem 0; font-weight: 700; color: var(--primary-dark);">Module</th>
                                    <th style="text-align: right; padding: 0.75rem 0; font-weight: 700; color: var(--primary-dark);">Tests</th>
                                </tr>
                            </thead>
                            <tbody id="moduleTable" style="border-top: 1px solid rgba(82, 183, 136, 0.15);"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Priority Details -->
                <div class="card-glass">
                    <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1.5rem;">
                        <i class="fas fa-list" style="color: var(--primary); font-size: 1.2rem;"></i>
                        <h3 style="font-size: 1.1rem; font-weight: 700; color: var(--text-main);">Chi ti·∫øt theo Priority</h3>
                    </div>
                    <div style="overflow-x: auto;">
                        <table style="width: 100%; font-size: 0.9rem; border-collapse: collapse;">
                            <thead>
                                <tr style="border-bottom: 2px solid rgba(82, 183, 136, 0.2);">
                                    <th style="text-align: left; padding: 0.75rem 0; font-weight: 700; color: var(--primary-dark);">Priority</th>
                                    <th style="text-align: right; padding: 0.75rem 0; font-weight: 700; color: var(--primary-dark);">Tests</th>
                                </tr>
                            </thead>
                            <tbody id="priorityTable" style="border-top: 1px solid rgba(82, 183, 136, 0.15);"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Export Section -->
            <div class="card-glass">
                <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1.5rem;">
                    <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #ec4899, #db2777); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-download" style="color: white; font-size: 1rem;"></i>
                    </div>
                    <h3 style="font-size: 1.1rem; font-weight: 700; color: var(--text-main);">Export Report</h3>
                </div>
                <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                    <button onclick="exportAsCSV()" class="btn-primary">
                        <i class="fas fa-file-csv"></i> Export as CSV
                    </button>
                    <button onclick="exportAsJSON()" class="btn-primary">
                        <i class="fas fa-file-code"></i> Export as JSON
                    </button>
                    <button onclick="printReport()" class="btn-primary" style="background: linear-gradient(135deg, #6b7280, #4b5563);">
                        <i class="fas fa-print"></i> Print Report
                    </button>
                </div>
            </div>
        </div>
    </main>

    <script>
        let analyticsData = null;
        let charts = {};

        // Initialize
        document.addEventListener('DOMContentLoaded', async () => {
            await loadAnalytics();
        });

        async function loadAnalytics() {
            try {
                const token = localStorage.getItem('token');
                if (!token) {
                    console.warn('No token found, redirecting to auth');
                    window.location.href = 'auth.html';
                    return;
                }

                console.log('üîê Loading analytics with token:', token.substring(0, 20) + '...');

                const response = await fetch('http://localhost:3000/api/analytics/summary', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                console.log('üìä Analytics response status:', response.status);
                const data = await response.json();
                console.log('üìä Analytics response data:', JSON.stringify(data, null, 2));

                if (!response.ok) throw new Error(`Failed to fetch analytics: ${data.error || response.statusText}`);

                analyticsData = data;
                displayAnalytics();
            } catch (error) {
                console.error('‚ùå Error loading analytics:', error);
                document.getElementById('loadingState').innerHTML = `
                    <div class="text-center">
                        <i class="fas fa-exclamation-circle text-4xl text-red-500 mb-4"></i>
                        <p class="text-red-600 text-lg font-medium">L·ªói t·∫£i d·ªØ li·ªáu: ${error.message}</p>
                        <p class="text-sm text-gray-600 mt-2">Ki·ªÉm tra console (F12) ƒë·ªÉ xem chi ti·∫øt</p>
                    </div>
                `;
            }
        }

        function displayAnalytics() {
            const { summary, byPriority, byModule, byType } = analyticsData;

            // Update summary cards
            document.getElementById('totalTests').textContent = summary.totalTests;
            document.getElementById('passedSteps').textContent = summary.passedSteps;
            document.getElementById('failedSteps').textContent = summary.failedSteps;
            document.getElementById('pendingSteps').textContent = summary.pendingSteps;
            document.getElementById('passRate').textContent = summary.passRate + '%';
            
            // Update pass rate progress bar
            const passRateValue = parseInt(summary.passRate) || 0;
            document.getElementById('passRateBar').style.width = passRateValue + '%';

            // Create charts
            createPassFailChart(summary);
            createPriorityChart(byPriority);
            createModuleChart(byModule);
            createTypeChart(byType);

            // Populate tables
            populateModuleTable(byModule);
            populatePriorityTable(byPriority);

            // Show content
            document.getElementById('loadingState').classList.add('hidden');
            document.getElementById('analyticsContent').classList.remove('hidden');
        }

        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            window.location.href = 'auth.html';
        }

        function createPassFailChart(summary) {
            const ctx = document.getElementById('passFailChart').getContext('2d');
            const colors = ['#10b981', '#ef4444', '#eab308'];
            
            charts.passFailChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Passed', 'Failed', 'Pending'],
                    datasets: [{
                        data: [summary.passedSteps, summary.failedSteps, summary.pendingSteps],
                        backgroundColor: colors,
                        borderColor: '#ffffff',
                        borderWidth: 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { 
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                font: { size: 13, weight: '600' },
                                usePointStyle: true,
                                pointStyle: 'circle'
                            }
                        }
                    }
                }
            });
        }

        function createPriorityChart(byPriority) {
            const ctx = document.getElementById('priorityChart').getContext('2d');
            const priorities = Object.keys(byPriority);
            const counts = Object.values(byPriority);
            const colors = {
                'Critical': '#dc2626',
                'High': '#ea580c',
                'Medium': '#eab308',
                'Low': '#3b82f6'
            };

            charts.priorityChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: priorities,
                    datasets: [{
                        label: 'Test Cases',
                        data: counts,
                        backgroundColor: priorities.map(p => colors[p] || '#9ca3af'),
                        borderRadius: 8,
                        borderSkipped: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    plugins: { 
                        legend: { display: false }
                    },
                    scales: { 
                        x: { 
                            beginAtZero: true,
                            grid: { color: 'rgba(0, 0, 0, 0.05)' }
                        }
                    }
                }
            });
        }

        function createModuleChart(byModule) {
            const ctx = document.getElementById('moduleChart').getContext('2d');
            const modules = Object.keys(byModule);
            const counts = Object.values(byModule);

            charts.moduleChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: modules,
                    datasets: [{
                        label: 'Test Cases',
                        data: counts,
                        backgroundColor: 'rgba(96, 165, 250, 0.8)',
                        borderRadius: 8,
                        borderSkipped: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { 
                        y: { 
                            beginAtZero: true,
                            grid: { color: 'rgba(0, 0, 0, 0.05)' }
                        }
                    }
                }
            });
        }

        function createTypeChart(byType) {
            const ctx = document.getElementById('typeChart').getContext('2d');
            const types = Object.keys(byType);
            const counts = Object.values(byType);
            const colors = ['#8b5cf6', '#3b82f6'];

            charts.typeChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: types,
                    datasets: [{
                        data: counts,
                        backgroundColor: colors,
                        borderColor: '#ffffff',
                        borderWidth: 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { 
                        legend: { 
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                font: { size: 13, weight: '600' },
                                usePointStyle: true,
                                pointStyle: 'circle'
                            }
                        }
                    }
                }
            });
        }

        function populateModuleTable(byModule) {
            const tbody = document.getElementById('moduleTable');
            tbody.innerHTML = Object.entries(byModule)
                .sort((a, b) => b[1] - a[1])
                .map(([module, count]) => `
                    <tr class="table-row-hover transition-all" style="border-bottom: 1px solid rgba(82, 183, 136, 0.1); padding: 0.75rem 0;">
                        <td style="padding: 0.75rem 0; color: var(--text-main); font-weight: 500;">${module || 'Uncategorized'}</td>
                        <td style="text-align: right; padding: 0.75rem 0; font-weight: 700; color: var(--primary);">${count}</td>
                    </tr>
                `).join('');
        }

        function populatePriorityTable(byPriority) {
            const tbody = document.getElementById('priorityTable');
            const priorityOrder = ['Critical', 'High', 'Medium', 'Low'];
            const colors = {
                'Critical': '#dc2626',
                'High': '#ea580c',
                'Medium': '#eab308',
                'Low': '#3b82f6'
            };

            tbody.innerHTML = priorityOrder
                .filter(p => byPriority[p])
                .map(p => `
                    <tr class="table-row-hover transition-all" style="border-bottom: 1px solid rgba(82, 183, 136, 0.1); padding: 0.75rem 0;">
                        <td style="padding: 0.75rem 0;"><span style="font-weight: 700; color: ${colors[p]};">${p}</span></td>
                        <td style="text-align: right; padding: 0.75rem 0; font-weight: 700;">${byPriority[p]}</td>
                    </tr>
                `).join('');
        }

        function exportAsCSV() {
            if (!analyticsData) return;
            
            const { summary, byModule, byPriority } = analyticsData;
            let csv = 'Analytics Report\n';
            csv += `Generated: ${new Date().toLocaleString('vi-VN')}\n\n`;
            csv += 'Summary\n';
            csv += `Total Tests,${summary.totalTests}\n`;
            csv += `Passed Steps,${summary.passedSteps}\n`;
            csv += `Failed Steps,${summary.failedSteps}\n`;
            csv += `Pending Steps,${summary.pendingSteps}\n`;
            csv += `Pass Rate,${summary.passRate}%\n\n`;
            csv += 'By Module\n';
            Object.entries(byModule).forEach(([module, count]) => {
                csv += `${module},${count}\n`;
            });
            csv += '\nBy Priority\n';
            Object.entries(byPriority).forEach(([priority, count]) => {
                csv += `${priority},${count}\n`;
            });

            downloadFile(csv, 'analytics-report.csv', 'text/csv');
        }

        function exportAsJSON() {
            if (!analyticsData) return;
            const json = JSON.stringify({
                ...analyticsData,
                generatedAt: new Date().toISOString()
            }, null, 2);
            downloadFile(json, 'analytics-report.json', 'application/json');
        }

        function downloadFile(content, filename, type) {
            const blob = new Blob([content], { type });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
        }

        function printReport() {
            window.print();
        }
    </script>
</body>
</html>
