<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Script Review - AI Testing Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .code-editor { font-family: 'Fira Code', monospace; }
        .spinner { animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes slideInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .animate-in { animation: slideInUp 0.6s ease-out forwards; }
        
        .card-hover { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .card-hover:hover { 
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(82, 183, 136, 0.2);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-[#f0fdf4] via-[#f5f5f5] to-[#f0fdf4] min-h-screen">

    <!-- Navbar -->
    <nav class="bg-gradient-to-r from-[#1b4332] via-[#2d6a4f] to-[#1b4332] text-white px-6 py-3 flex justify-between items-center sticky top-0 z-50 shadow-xl">
        <div class="flex items-center gap-8">
            <div class="flex items-center gap-2">
                <div class="bg-[#52b788] p-1.5 rounded-lg shadow-lg"><i class="fas fa-leaf text-white"></i></div>
                <span class="text-lg font-bold tracking-tight">AI<span class="text-[#52b788]">-TestLab</span></span>
            </div>
            <div class="hidden md:flex gap-6 text-sm font-medium text-gray-300">
                <a href="dashboard.html" class="hover:text-white transition">T·ªïng quan</a>
                <a href="test-creation.html" class="hover:text-white transition">Test Cases</a>
                <a href="analytics.html" class="hover:text-white transition">Ph√¢n t√≠ch</a>
                <a href="#" class="text-white border-b-2 border-[#52b788] pb-1 font-semibold">Script Review</a>
            </div>
        </div>
        <div class="flex items-center gap-4">
            <span class="text-sm text-gray-300"><i class="far fa-clock mr-1"></i> T·ª± ƒë·ªông l∆∞u</span>
            <div class="h-8 w-8 bg-gradient-to-tr from-[#52b788] to-[#40916c] rounded-full flex items-center justify-center font-bold text-xs shadow-lg">SR</div>
        </div>
    </nav>

    <!-- Main Layout -->
    <div class="max-w-full mx-auto grid grid-cols-12 gap-0 h-[calc(100vh-70px)] overflow-hidden">
        
        <!-- Sidebar -->
        <aside class="col-span-3 md:col-span-2 border-r border-gray-200 bg-gradient-to-b from-[#f8fafb] to-white p-5 overflow-y-auto shadow-sm">
            <div class="mb-6">
                <h2 class="text-xs font-bold text-[#52b788] uppercase tracking-widest mb-1">üìù Input</h2>
                <p class="text-xs text-gray-500">D√°n code c·ªßa b·∫°n</p>
            </div>

            <!-- Code Input -->
            <div class="mb-5 p-4 bg-gradient-to-br from-blue-50 to-blue-50 rounded-xl border border-blue-200">
                <label class="block text-xs font-bold text-[#1b4332] mb-2"><i class="fas fa-code mr-1.5 text-blue-600"></i>Test Script</label>
                <textarea id="codeInput" class="w-full border border-blue-300 rounded-lg p-2.5 text-xs focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white resize-none shadow-sm" placeholder="Paste Cypress test script here..." style="height: 280px; font-family: 'Fira Code', monospace;"></textarea>
                <button onclick="analyzeCode()" class="w-full mt-3 bg-gradient-to-r from-[#52b788] to-[#40916c] text-white font-bold py-2.5 px-3 rounded-lg hover:shadow-lg transform hover:scale-105 transition text-sm">
                    <i class="fas fa-magic mr-1.5"></i> Ph√¢n t√≠ch ngay
                </button>
            </div>

            <!-- Language Selection -->
            <div class="mb-5 p-4 bg-gradient-to-br from-purple-50 to-purple-50 rounded-xl border border-purple-200">
                <label class="block text-xs font-bold text-[#1b4332] mb-2"><i class="fas fa-code-branch mr-1.5 text-purple-600"></i>Ng√¥n ng·ªØ</label>
                <select id="languageSelect" class="w-full border border-purple-300 rounded-lg p-2.5 text-xs focus:outline-none focus:ring-2 focus:ring-purple-500 bg-white shadow-sm">
                    <option value="javascript">JavaScript</option>
                    <option value="python">Python</option>
                    <option value="cypress">Cypress</option>
                    <option value="typescript">TypeScript</option>
                    <option value="other">Kh√°c</option>
                </select>
            </div>

            <!-- Quick Actions -->
            <div class="space-y-2 mb-4">
                <button onclick="loadExample()" class="w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white font-semibold py-2.5 px-3 rounded-lg hover:shadow-lg transform hover:scale-105 transition text-sm">
                    <i class="fas fa-book mr-1.5"></i> V√≠ d·ª•
                </button>
                <button onclick="clearCode()" class="w-full bg-gradient-to-r from-red-500 to-red-600 text-white font-semibold py-2.5 px-3 rounded-lg hover:shadow-lg transform hover:scale-105 transition text-sm">
                    <i class="fas fa-trash mr-1.5"></i> X√≥a
                </button>
            </div>

            <!-- Info Box -->
            <div class="p-4 bg-gradient-to-br from-amber-50 to-amber-50 rounded-xl border border-amber-200">
                <p class="text-xs text-amber-900 font-semibold mb-1"><i class="fas fa-lightbulb mr-1.5"></i>M·∫πo</p>
                <p class="text-xs text-amber-800">D√°n test case Cypress ƒë·ªÉ nh·∫≠n ph√¢n t√≠ch chi ti·∫øt t·ª´ AI</p>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="col-span-9 md:col-span-10 bg-white overflow-y-auto p-8">
            <!-- Header Section -->
            <div class="mb-8 animate-in">
                <div class="flex items-start justify-between mb-4">
                    <div class="flex items-center gap-4">
                        <div class="bg-gradient-to-br from-[#52b788] to-[#40916c] w-14 h-14 rounded-xl flex items-center justify-center text-white shadow-lg">
                            <i class="fas fa-code text-2xl"></i>
                        </div>
                        <div>
                            <h1 class="text-3xl font-bold text-[#1b4332]">Script Review</h1>
                            <p class="text-sm text-gray-600 mt-1"><i class="fas fa-sparkles mr-1 text-[#52b788]"></i>Ph√¢n t√≠ch & c·∫£i thi·ªán test scripts v·ªõi AI</p>
                        </div>
                    </div>
                </div>
                <div class="h-1 w-24 bg-gradient-to-r from-[#52b788] to-[#40916c] rounded-full"></div>
            </div>

            <!-- Feature Cards Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-5 mb-8">
                <!-- Syntax Analysis -->
                <div class="card-hover p-6 rounded-2xl border border-blue-200 bg-gradient-to-br from-blue-50 to-blue-50 shadow-sm">
                    <div class="flex items-start mb-3">
                        <div class="w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center text-white mr-3">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <h3 class="font-bold text-[#1b4332] text-lg">Ph√¢n t√≠ch Syntax</h3>
                    </div>
                    <p class="text-sm text-gray-700">Ki·ªÉm tra l·ªói c√∫ ph√°p, c·∫•u tr√∫c code v√† ph√°t hi·ªán issues</p>
                    <div class="mt-4 text-xs text-blue-600 font-semibold">‚Üí Ph√°t hi·ªán 10+ lo·∫°i l·ªói</div>
                </div>

                <!-- Code Standards -->
                <div class="card-hover p-6 rounded-2xl border border-green-200 bg-gradient-to-br from-green-50 to-green-50 shadow-sm">
                    <div class="flex items-start mb-3">
                        <div class="w-10 h-10 bg-green-500 rounded-lg flex items-center justify-center text-white mr-3">
                            <i class="fas fa-shield"></i>
                        </div>
                        <h3 class="font-bold text-[#1b4332] text-lg">Quy chu·∫©n Code</h3>
                    </div>
                    <p class="text-sm text-gray-700">Tu√¢n theo best practices v√† quy t·∫Øc l·∫≠p tr√¨nh</p>
                    <div class="mt-4 text-xs text-green-600 font-semibold">‚Üí Check 15+ standards</div>
                </div>

                <!-- Complexity -->
                <div class="card-hover p-6 rounded-2xl border border-purple-200 bg-gradient-to-br from-purple-50 to-purple-50 shadow-sm">
                    <div class="flex items-start mb-3">
                        <div class="w-10 h-10 bg-purple-500 rounded-lg flex items-center justify-center text-white mr-3">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <h3 class="font-bold text-[#1b4332] text-lg">ƒê·ªô Ph·ª©c T·∫°p</h3>
                    </div>
                    <p class="text-sm text-gray-700">ƒê√°nh gi√° cyclomatic complexity v√† maintainability</p>
                    <div class="mt-4 text-xs text-purple-600 font-semibold">‚Üí T·ªëi ∆∞u h√≥a code</div>
                </div>

                <!-- Warnings -->
                <div class="card-hover p-6 rounded-2xl border border-amber-200 bg-gradient-to-br from-amber-50 to-amber-50 shadow-sm">
                    <div class="flex items-start mb-3">
                        <div class="w-10 h-10 bg-amber-500 rounded-lg flex items-center justify-center text-white mr-3">
                            <i class="fas fa-exclamation"></i>
                        </div>
                        <h3 class="font-bold text-[#1b4332] text-lg">C·∫£nh B√°o</h3>
                    </div>
                    <p class="text-sm text-gray-700">Ph√°t hi·ªán l·ªói ti·ªÅm ·∫©n v√† issues b·∫£o m·∫≠t</p>
                    <div class="mt-4 text-xs text-amber-600 font-semibold">‚Üí Ki·ªÉm tra 8+ v·∫•n ƒë·ªÅ</div>
                </div>
            </div>

            <!-- Stats Section -->
            <div class="grid grid-cols-3 gap-4 mb-8">
                <div class="p-5 rounded-xl bg-gradient-to-br from-[#52b788] to-[#40916c] text-white shadow-lg">
                    <p class="text-xs opacity-90 uppercase tracking-wide font-semibold">Ng√¥n ng·ªØ h·ªó tr·ª£</p>
                    <p class="text-2xl font-bold mt-1">5+</p>
                </div>
                <div class="p-5 rounded-xl bg-gradient-to-br from-blue-500 to-blue-600 text-white shadow-lg">
                    <p class="text-xs opacity-90 uppercase tracking-wide font-semibold">Ki·ªÉm tra</p>
                    <p class="text-2xl font-bold mt-1">50+</p>
                </div>
                <div class="p-5 rounded-xl bg-gradient-to-br from-purple-500 to-purple-600 text-white shadow-lg">
                    <p class="text-xs opacity-90 uppercase tracking-wide font-semibold">ƒê·ªô ch√≠nh x√°c</p>
                    <p class="text-2xl font-bold mt-1">99%</p>
                </div>
            </div>

            <!-- Getting Started -->
            <div class="p-6 rounded-2xl border-2 border-dashed border-[#52b788] bg-gradient-to-br from-green-50 to-emerald-50">
                <div class="flex items-start gap-4">
                    <div class="w-12 h-12 bg-[#52b788] rounded-lg flex items-center justify-center text-white flex-shrink-0">
                        <i class="fas fa-rocket text-lg"></i>
                    </div>
                    <div>
                        <h3 class="font-bold text-[#1b4332] text-lg mb-1">B·∫Øt ƒë·∫ßu ngay</h3>
                        <p class="text-sm text-gray-700 mb-3">D√°n test script c·ªßa b·∫°n ·ªü sidebar tr√°i, sau ƒë√≥ nh·∫•n "Ph√¢n t√≠ch ngay" ƒë·ªÉ nh·∫≠n k·∫øt qu·∫£ chi ti·∫øt</p>
                        <button onclick="loadExample()" class="text-sm font-semibold text-[#52b788] hover:text-[#40916c] transition">
                            <i class="fas fa-arrow-right mr-1"></i> Xem v√≠ d·ª•
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        const API_URL = 'http://localhost:3000';

        function analyzeCode() {
            const code = document.getElementById('codeInput').value.trim();
            if (!code) {
                alert('‚ö†Ô∏è Vui l√≤ng nh·∫≠p test script tr∆∞·ªõc');
                return;
            }

            // Call backend API
            fetch(`${API_URL}/api/review-test-script`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ code })
            })
            .then(response => response.json())
            .then(data => {
                console.log('üìä API Response:', data);
                if (data.status === 'success' || data.summary) {
                    displayReviewResults(data);
                } else {
                    alert('‚ùå L·ªói: ' + (data.error || 'Kh√¥ng th·ªÉ ph√¢n t√≠ch code'));
                }
            })
            .catch(error => {
                console.error('‚ùå API Error:', error);
                alert('‚ùå L·ªói k·∫øt n·ªëi: ' + error.message);
            });
        }

        function displayReviewResults(data) {
            // Get results container or create it
            let resultsContainer = document.getElementById('resultsContainer');
            if (!resultsContainer) {
                resultsContainer = document.createElement('div');
                resultsContainer.id = 'resultsContainer';
                resultsContainer.className = 'col-span-10 bg-white rounded-lg p-6 shadow-lg border border-gray-200';
                document.querySelector('main .grid').appendChild(resultsContainer);
            }

            // Build HTML for results
            let html = `
                <div class="mb-6">
                    <h3 class="text-xl font-bold text-[#1b4332] mb-2">üìä K·∫øt Qu·∫£ Ph√¢n T√≠ch</h3>
                    <p class="text-gray-600 mb-4">${data.summary || 'Ph√¢n t√≠ch ho√†n t·∫•t'}</p>
                    
                    ${data.metrics ? `
                    <div class="grid grid-cols-3 gap-4 mb-6">
                        <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                            <p class="text-sm text-gray-600">Ch·∫•t L∆∞·ª£ng</p>
                            <p class="text-2xl font-bold text-blue-600">${data.metrics.quality || 'N/A'}</p>
                        </div>
                        <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                            <p class="text-sm text-gray-600">ƒêi·ªÉm S·ªë</p>
                            <p class="text-2xl font-bold text-green-600">${data.metrics.score || 'N/A'}/10</p>
                        </div>
                        <div class="bg-purple-50 p-4 rounded-lg border border-purple-200">
                            <p class="text-sm text-gray-600">ƒê·ªô Ph·ª©c T·∫°p</p>
                            <p class="text-2xl font-bold text-purple-600">${data.metrics.complexity || 'N/A'}</p>
                        </div>
                    </div>
                    ` : ''}
                </div>

                ${data.issues && data.issues.length > 0 ? `
                <div class="mb-6">
                    <h4 class="text-lg font-semibold text-red-600 mb-3">‚ö†Ô∏è V·∫•n ƒê·ªÅ T√¨m Th·∫•y (${data.issues.length})</h4>
                    ${data.issues.map(issue => `
                        <div class="bg-red-50 p-4 rounded-lg mb-3 border-l-4 border-red-500">
                            <p class="font-semibold text-red-700">[${issue.type}] ${issue.title}</p>
                            <p class="text-sm text-gray-700 mt-1">${issue.description}</p>
                            ${issue.suggestion ? `<p class="text-sm text-gray-600 mt-2 italic">üí° ${issue.suggestion}</p>` : ''}
                        </div>
                    `).join('')}
                </div>
                ` : '<div class="mb-6 text-green-600">‚úÖ Kh√¥ng t√¨m th·∫•y v·∫•n ƒë·ªÅ l·ªõn</div>'}

                ${data.recommendations && data.recommendations.length > 0 ? `
                <div class="mb-6">
                    <h4 class="text-lg font-semibold text-green-600 mb-3">‚ú® G·ª£i √ù C·∫£i Thi·ªán (${data.recommendations.length})</h4>
                    ${data.recommendations.map(rec => `
                        <div class="bg-green-50 p-4 rounded-lg mb-3 border-l-4 border-green-500">
                            <p class="text-sm text-gray-700">‚Ä¢ ${rec}</p>
                        </div>
                    `).join('')}
                </div>
                ` : ''}

                ${data.improvedCode ? `
                <div class="mb-6">
                    <h4 class="text-lg font-semibold text-[#52b788] mb-3">üìù Code C·∫£i Thi·ªán</h4>
                    <pre class="bg-gray-900 text-green-400 p-4 rounded-lg overflow-x-auto text-xs"><code>${escapeHtml(data.improvedCode)}</code></pre>
                </div>
                ` : ''}
            `;

            resultsContainer.innerHTML = html;
            resultsContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }

        function loadExample() {
            const example = `describe('Login Test Suite', () => {
  beforeEach(() => {
    cy.visit('http://localhost:8080/login.html')
  })

  it('should login with valid credentials', () => {
    cy.get('input[name=email]').type('user@example.com')
    cy.get('input[name=password]').type('password123')
    cy.get('button[type=submit]').click()
    cy.url().should('include', '/dashboard')
    cy.get('[data-testid=welcome]').should('be.visible')
  })

  it('should show error for invalid password', () => {
    cy.get('input[name=email]').type('user@example.com')
    cy.get('input[name=password]').type('wrongpass')
    cy.get('button[type=submit]').click()
    cy.contains('Invalid credentials').should('be.visible')
  })
})`;
            document.getElementById('codeInput').value = example;
        }

        function clearCode() {
            if (confirm('X√≥a t·∫•t c·∫£ code?')) {
                document.getElementById('codeInput').value = '';
            }
        }
    </script>
</body>
</html>
