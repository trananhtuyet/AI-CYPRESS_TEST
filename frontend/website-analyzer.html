<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Website Analyzer - AI Testing Platform</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #52b788;
            --primary-dark: #1b4332;
            --primary-light: #74c69d;
            --secondary: #40916c;
            --accent: #2d6a4f;
            --card-bg: #f8fafc;
            --card-border: #e2e8f0;
            --text-main: #1e293b;
            --text-muted: #64748b;
            --text-light: #94a3b8;
            --ai-gradient: linear-gradient(135deg, #52b788 0%, #40916c 100%);
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --sidebar-width: 280px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Plus Jakarta Sans', sans-serif;
        }

        html, body {
            width: 100%;
            height: 100%;
        }

        body {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            color: var(--text-main);
            display: flex;
            min-height: 100vh;
        }

        /* ===== SIDEBAR ===== */
        .sidebar {
            width: var(--sidebar-width);
            height: 100vh;
            background: white;
            border-right: 1px solid rgba(82, 183, 136, 0.15);
            position: fixed;
            display: flex;
            flex-direction: column;
            box-shadow: 0 10px 30px rgba(27, 67, 50, 0.08);
            z-index: 100;
        }

        .sidebar-brand {
            padding: 2rem 1.5rem;
            font-size: 1.4rem;
            font-weight: 800;
            color: var(--primary-dark);
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 1px solid rgba(82, 183, 136, 0.15);
        }

        .sidebar-brand i {
            font-size: 1.6rem;
            color: var(--primary);
        }

        .sidebar-menu {
            flex: 1;
            padding: 1.5rem 0.8rem;
            overflow-y: auto;
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 1rem 1.2rem;
            color: var(--text-muted);
            text-decoration: none;
            border-radius: 12px;
            margin-bottom: 0.5rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 500;
            font-size: 0.95rem;
        }

        .menu-item i {
            margin-right: 12px;
            width: 20px;
            text-align: center;
            font-size: 1.1rem;
        }

        .menu-item:hover {
            background: linear-gradient(135deg, rgba(82, 183, 136, 0.1), rgba(82, 183, 136, 0.05));
            color: var(--primary);
            transform: translateX(5px);
        }

        .menu-item.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            box-shadow: 0 8px 20px rgba(82, 183, 136, 0.3);
        }

        .sidebar-footer {
            padding: 1rem 0.8rem;
            border-top: 1px solid rgba(82, 183, 136, 0.15);
        }

        .btn-logout {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none;
            color: white;
            padding: 1rem 1.2rem;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.3s;
            box-shadow: 0 8px 20px rgba(82, 183, 136, 0.3);
        }

        .btn-logout:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 30px rgba(82, 183, 136, 0.4);
        }

        .btn-logout i {
            font-size: 1.1rem;
        }

        /* ===== MAIN CONTENT ===== */
        .main-content {
            margin-left: var(--sidebar-width);
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            padding: 2.5rem;
            overflow-y: auto;
        }

        /* ===== PAGE HEADER ===== */
        .page-header {
            margin-bottom: 2.5rem;
        }

        .page-title {
            font-size: 2.2rem;
            font-weight: 800;
            background: var(--ai-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            line-height: 1.2;
            margin-bottom: 0.5rem;
        }

        .page-subtitle {
            color: var(--text-muted);
            font-size: 0.95rem;
            margin: 0;
        }

        /* ===== SEARCH SECTION ===== */
        .search-wrapper {
            background: white;
            padding: 10px;
            border-radius: 18px;
            display: flex;
            gap: 1rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--card-border);
            margin-bottom: 2.5rem;
        }

        .search-wrapper input {
            flex: 1;
            border: none;
            padding: 12px 20px;
            font-size: 1rem;
            outline: none;
            background: transparent;
            color: var(--text-main);
        }

        .search-wrapper input::placeholder {
            color: var(--text-light);
        }

        .btn-analyze {
            background: var(--ai-gradient);
            color: white;
            border: none;
            padding: 12px 32px;
            border-radius: 14px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 8px 20px rgba(82, 183, 136, 0.3);
            white-space: nowrap;
        }

        .btn-analyze:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 30px rgba(82, 183, 136, 0.4);
        }

        .btn-analyze:active {
            transform: translateY(0);
        }

        /* ===== STATS GRID ===== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2.5rem;
        }

        .stat-card {
            background: white;
            padding: 1.8rem;
            border-radius: 18px;
            border: 1px solid var(--card-border);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.03);
            display: flex;
            align-items: center;
            gap: 20px;
            transition: all 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.08);
            border-color: var(--primary);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            flex-shrink: 0;
        }

        .icon-blue {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            color: #1b4332;
        }

        .icon-purple {
            background: linear-gradient(135deg, #b7e4c7 0%, #95d5b2 100%);
            color: #2d6a4f;
        }

        .icon-green {
            background: linear-gradient(135deg, #52b788 0%, #40916c 100%);
            color: #ffffff;
        }

        .stat-info h3 {
            font-size: 1.8rem;
            font-weight: 800;
            background: var(--ai-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-info p {
            color: var(--text-muted);
            font-size: 0.875rem;
            font-weight: 500;
            margin-top: 4px;
        }

        /* ===== DASHBOARD GRID ===== */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 2rem;
        }

        .card {
            background: white;
            border-radius: 18px;
            padding: 1.8rem;
            border: 1px solid var(--card-border);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.03);
            margin-bottom: 2rem;
            transition: all 0.3s;
        }

        .card:hover {
            border-color: var(--primary);
            box-shadow: 0 10px 30px rgba(82, 183, 136, 0.1);
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .card-header h2 {
            font-size: 1.15rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--text-main);
        }

        .card-header i {
            color: var(--primary);
            font-size: 1.3rem;
        }

        /* ===== FEATURE TAGS ===== */
        .feature-tag {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 1rem;
            background: linear-gradient(135deg, #d1fae5 0%, #b7e4c7 100%);
            border: 1px solid rgba(82, 183, 136, 0.2);
            border-radius: 14px;
            margin-bottom: 12px;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-main);
            transition: all 0.3s;
        }

        .feature-tag:hover {
            background: linear-gradient(135deg, #b7e4c7 0%, #95d5b2 100%);
            border-color: var(--primary);
            transform: translateX(5px);
        }

        .feature-tag i {
            color: var(--primary);
            font-size: 1.2rem;
        }

        /* ===== AI TEST ITEM ===== */
        .ai-test-item {
            border: 1.5px solid var(--card-border);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            position: relative;
            background: white;
            transition: all 0.3s;
        }

        .ai-test-item:hover {
            border-color: var(--primary);
            box-shadow: 0 10px 30px rgba(82, 183, 136, 0.15);
            transform: translateY(-3px);
        }

        .ai-badge {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            background: var(--ai-gradient);
            color: white;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .ai-test-item h3 {
            font-size: 1rem;
            font-weight: 700;
            color: var(--text-main);
            margin-bottom: 8px;
            padding-right: 100px;
        }

        .ai-test-item p {
            font-size: 0.875rem;
            color: var(--text-muted);
            margin-bottom: 1rem;
            line-height: 1.5;
        }

        .ai-test-items {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .ai-test-items .card-header {
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--primary-light);
        }

        .ai-test-items .card-header h2 {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            color: var(--primary-dark);
            font-size: 1.3rem;
        }

        .ai-test-items .ai-test-item {
            padding: 1.2rem;
            border: 1px solid var(--card-border);
            border-radius: 10px;
            background: white;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .ai-test-items .ai-test-item:hover {
            box-shadow: 0 8px 24px rgba(82, 183, 136, 0.12);
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        /* ===== CODE BLOCK ===== */
        .code-block {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            color: #e2e8f0;
            padding: 1.25rem;
            border-radius: 12px;
            font-family: 'Fira Code', 'Courier New', monospace;
            font-size: 0.85rem;
            margin-top: 1rem;
            position: relative;
            overflow-x: auto;
            border: 1px solid rgba(226, 232, 240, 0.1);
            line-height: 1.6;
        }

        .code-block pre {
            margin: 0;
            font-family: inherit;
        }

        /* ===== BUTTONS ===== */
        .btn-run {
            background: white;
            color: var(--text-main);
            border: 1.5px solid var(--card-border);
            padding: 10px 18px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .btn-run:hover {
            background: var(--ai-gradient);
            color: white;
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(82, 183, 136, 0.25);
        }

        .btn-run:active {
            transform: translateY(0);
        }

        /* ===== SPECIAL CARD ===== */
        .special-card {
            background: var(--ai-gradient);
            color: white;
            border: none;
        }

        .special-card h3 {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 0.8rem;
        }

        .special-card p {
            font-size: 0.9rem;
            margin: 12px 0 20px;
            opacity: 0.95;
            line-height: 1.5;
        }

        .special-card .btn-run {
            width: 100%;
            background: white;
            color: var(--primary);
            border: none;
            padding: 14px;
            font-weight: 700;
            justify-content: center;
        }

        .special-card .btn-run:hover {
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 1200px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .main-content {
                padding: 1.5rem;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: -280px;
                transition: left 0.3s;
                z-index: 1000;
            }

            .sidebar.active {
                left: 0;
            }

            .main-content {
                margin-left: 0;
                padding: 1.5rem;
            }

            .page-title {
                font-size: 1.6rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .search-wrapper {
                flex-direction: column;
            }

            .btn-analyze {
                justify-content: center;
            }

            .card-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .card-header h2 {
                width: 100%;
            }

            .ai-badge {
                top: 1rem;
                right: 1rem;
            }

            .ai-test-item h3 {
                padding-right: 0;
            }
        }

        @media (max-width: 480px) {
            .page-title {
                font-size: 1.4rem;
            }

            .stat-card {
                flex-direction: column;
                text-align: center;
            }

            .card {
                padding: 1.2rem;
                border-radius: 14px;
            }

            .code-block {
                font-size: 0.75rem;
                padding: 1rem;
            }
        }

        /* Scrollbar styling */
        .sidebar-menu::-webkit-scrollbar {
            width: 6px;
        }

        .sidebar-menu::-webkit-scrollbar-track {
            background: transparent;
        }

        .sidebar-menu::-webkit-scrollbar-thumb {
            background: rgba(82, 183, 136, 0.2);
            border-radius: 3px;
        }

        .sidebar-menu::-webkit-scrollbar-thumb:hover {
            background: rgba(82, 183, 136, 0.4);
        }

        .main-content::-webkit-scrollbar {
            width: 8px;
        }

        .main-content::-webkit-scrollbar-track {
            background: transparent;
        }

        .main-content::-webkit-scrollbar-thumb {
            background: rgba(82, 183, 136, 0.2);
            border-radius: 4px;
        }

        .main-content::-webkit-scrollbar-thumb:hover {
            background: rgba(82, 183, 136, 0.4);
        }

        /* ===== TABS STYLES ===== */
        .tabs-container {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid var(--card-border);
        }

        .tab-button {
            padding: 0.75rem 1.5rem;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            color: var(--text-muted);
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 0.95rem;
        }

        .tab-button:hover {
            color: var(--primary);
        }

        .tab-button.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* ===== MODAL STYLES ===== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .modal.active {
            display: flex;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(27, 67, 50, 0.3);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--card-border);
        }

        .modal-header h2 {
            color: var(--primary-dark);
            font-size: 1.5rem;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-muted);
            transition: color 0.3s;
        }

        .modal-close:hover {
            color: var(--text-main);
        }

        .form-group {
            margin-bottom: 1.2rem;
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            color: var(--text-main);
            margin-bottom: 0.5rem;
            font-size: 0.95rem;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            padding: 0.75rem;
            border: 1.5px solid var(--card-border);
            border-radius: 8px;
            font-family: inherit;
            font-size: 0.95rem;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(82, 183, 136, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .modal-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 2px solid var(--card-border);
        }

        .btn-cancel {
            background: white;
            color: var(--text-main);
            border: 1.5px solid var(--card-border);
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-cancel:hover {
            background: var(--card-bg);
            border-color: var(--primary);
        }

        .btn-submit {
            background: var(--ai-gradient);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(82, 183, 136, 0.3);
        }

        .btn-submit:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
    </style>
</head>
<body>
    <!-- SIDEBAR -->
    <aside class="sidebar">
        <div class="sidebar-brand">
            <i class="fas fa-wand-magic-sparkles"></i>
            <span>AI-TestLab</span>
        </div>
        <nav class="sidebar-menu">
            <a href="dashboard.html" class="menu-item">
                <i class="fas fa-home"></i>
                <span>T·ªïng quan</span>
            </a>
            <a href="test-creation.html" class="menu-item">
                <i class="fas fa-pencil"></i>
                <span>T·∫°o Test Case</span>
            </a>
            <a href="analytics.html" class="menu-item">
                <i class="fas fa-chart-bar"></i>
                <span>Analytics</span>
            </a>
            <a href="website-analyzer.html" class="menu-item active">
                <i class="fas fa-globe"></i>
                <span>Website Analyzer</span>
            </a>
            <a href="script-review.html" class="menu-item">
                <i class="fas fa-code"></i>
                <span>Script Review</span>
            </a>
        </nav>
        <div class="sidebar-footer">
            <button class="btn-logout" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i>
                <span>ƒêƒÉng Xu·∫•t</span>
            </button>
        </div>
    </aside>

    <!-- MAIN CONTENT -->
    <div class="main-content">
        <!-- PAGE HEADER -->
        <header class="page-header">
            <h1 class="page-title">Website Analyzer</h1>
            <p class="page-subtitle">S·ª≠ d·ª•ng AI ƒë·ªÉ b√≥c t√°ch c·∫•u tr√∫c v√† t·∫°o k·ªãch b·∫£n ki·ªÉm th·ª≠ t·ª± ƒë·ªông trong gi√¢y l√°t.</p>
        </header>

        <!-- SEARCH SECTION -->
        <div class="search-wrapper">
            <input type="url" placeholder="D√°n link website b·∫°n mu·ªën ph√¢n t√≠ch t·∫°i ƒë√¢y..." id="urlInput">
            <button class="btn-analyze" onclick="analyzeSite()">
                <i class="fas fa-magnifying-glass"></i> Ph√¢n t√≠ch ngay
            </button>
        </div>

        <!-- STATS GRID -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon icon-blue">
                    <i class="fas fa-puzzle-piece"></i>
                </div>
                <div class="stat-info">
                    <h3 id="featuresCount">0</h3>
                    <p>Ch·ª©c nƒÉng t√¨m th·∫•y</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon icon-purple">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="stat-info">
                    <h3 id="testCasesCount">0</h3>
                    <p>AI Test Cases</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon icon-green">
                    <i class="fas fa-shield-check"></i>
                </div>
                <div class="stat-info">
                    <h3 id="customTestCount">0</h3>
                    <p>Test t√πy ch·ªânh</p>
                </div>
            </div>
        </div>

        <!-- MAIN GRID -->
        <div class="dashboard-grid">
            <!-- LEFT COLUMN -->
            <div class="left-col">
                <!-- FEATURES CARD -->
                <div class="card">
                    <div class="card-header">
                        <h2>
                            <i class="fas fa-list-check"></i>
                            Ch·ª©c nƒÉng ph√°t hi·ªán
                        </h2>
                        <span style="font-size: 0.8rem; color: var(--text-light);">Auto-detected</span>
                    </div>
                    <p style="text-align: center; color: #999; padding: 2rem 0;">Ph√¢n t√≠ch website ƒë·ªÉ xem c√°c ch·ª©c nƒÉng ƒë∆∞·ª£c ph√°t hi·ªán</p>
                </div>
            </div>

            <!-- RIGHT COLUMN -->
            <div class="right-col">
                <!-- ADD TEST CARD -->
                <div class="card special-card">
                    <h3>
                        <i class="fas fa-sparkles"></i>
                        T·∫°o Test Case m·ªõi?
                    </h3>
                    <p>T·ª± vi·∫øt k·ªãch b·∫£n c·ªßa ri√™ng b·∫°n ƒë·ªÉ AI t·ªëi ∆∞u h√≥a code v√† hi·ªáu su·∫•t.</p>
                    <button class="btn-run" onclick="openCreateTestCaseModal()">
                        <i class="fas fa-plus"></i> T·∫°o k·ªãch b·∫£n m·ªõi
                    </button>
                </div>

                <!-- TABS -->
                <div class="tabs-container" id="testTabsContainer" style="display: none;">
                    <button class="tab-button active" onclick="switchTab('custom-tests')">
                        <i class="fas fa-pen"></i> Test T√πy Ch·ªânh
                    </button>
                    <button class="tab-button" onclick="switchTab('ai-tests')">
                        <i class="fas fa-magic"></i> AI Test Cases
                    </button>
                </div>

                <!-- CUSTOM TESTS TAB (Show first) -->
                <div class="card tab-content active" id="customTestsTab">
                    <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                        <h2 style="margin: 0;">
                            <i class="fas fa-pen"></i>
                            Test T√πy Ch·ªânh
                        </h2>
                        <button class="btn-run" onclick="optimizeCustomTests()" style="background: #40916c; color: white;">
                            <i class="fas fa-wand-magic-sparkles"></i> AI T·ªëi ∆Øu
                        </button>
                    </div>
                    <div id="customTestsContainer" style="padding: 1rem 0;">
                        <p style="text-align: center; color: #999; padding: 2rem 0;">T·∫°o test case m·ªõi ƒë·ªÉ b·∫Øt ƒë·∫ßu</p>
                    </div>
                </div>

                <!-- AI TESTS TAB -->
                <div class="card tab-content" id="aiTestsTab">
                    <div class="card-header">
                        <h2>
                            <i class="fas fa-code-branch"></i>
                            K·ªãch b·∫£n AI ƒë·ªÅ xu·∫•t
                        </h2>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn-run" onclick="runAllTests()">
                                <i class="fas fa-play"></i> Run All
                            </button>
                            <button class="btn-run" onclick="exportTests()">
                                <i class="fas fa-download"></i> Export
                            </button>
                        </div>
                    </div>
                    <p style="text-align: center; color: #999; padding: 2rem 0;">Click v√†o ch·ª©c nƒÉng b√™n tr√°i ƒë·ªÉ xem test cases</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:3000';

        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            window.location.href = 'auth.html';
        }

        async function analyzeSite() {
            const url = document.getElementById('urlInput').value;
            if (!url) {
                alert('Vui l√≤ng nh·∫≠p URL');
                return;
            }

            console.log('Analyzing:', url);
            
            const analyzeBtn = event.target;
            const originalHTML = analyzeBtn.innerHTML;
            analyzeBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ƒêang ph√¢n t√≠ch...';
            analyzeBtn.disabled = true;

            try {
                // Call backend to analyze website features
                console.log('üì§ Calling API:', `${API_URL}/api/analyze-website-features`);
                console.log('üì§ POST data:', { url });
                
                const response = await fetch(`${API_URL}/api/analyze-website-features`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ url })
                });

                console.log('üì• Response status:', response.status);
                console.log('üì• Response ok:', response.ok);
                
                // Check status first
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('Error response:', errorText);
                    throw new Error(`HTTP ${response.status}: ${errorText.substring(0, 200)}`);
                }

                // Parse JSON
                let data;
                try {
                    data = await response.json();
                } catch (parseError) {
                    console.error('JSON parse error:', parseError);
                    throw new Error('Invalid JSON response from server');
                }

                console.log('üì• Response data:', data);

                // Display features
                displayFeatures(data.features, url);
                alert('‚úÖ Ph√¢n t√≠ch th√†nh c√¥ng! T√¨m th·∫•y ' + data.features.length + ' ch·ª©c nƒÉng');
                
            } catch (error) {
                console.error('‚ùå Error:', error);
                alert('‚ùå L·ªói ph√¢n t√≠ch: ' + error.message);
            } finally {
                analyzeBtn.innerHTML = originalHTML;
                analyzeBtn.disabled = false;
            }
        }

        function displayFeatures(features, url) {
            // Update stats
            document.getElementById('featuresCount').textContent = features.length;
            document.getElementById('testCasesCount').textContent = (features.length * 3);
            
            // Show tabs container
            document.getElementById('testTabsContainer').style.display = 'flex';
            
            // Hide initial AI card
            const initialCard = document.getElementById('initialAICard');
            if (initialCard) {
                initialCard.style.display = 'none';
            }
            
            // Find or create container for left-col features
            let leftContainer = document.querySelector('.left-col .card:first-child');
            if (!leftContainer) {
                console.error('Left column not found');
                return;
            }

            // Clear existing feature tags (keep header)
            const existingTags = leftContainer.querySelectorAll('.feature-tag');
            existingTags.forEach(tag => tag.remove());
            
            // Add feature tags to left column
            if (features && features.length > 0) {
                features.forEach((feature, index) => {
                    const tag = document.createElement('div');
                    tag.className = 'feature-tag';
                    tag.style.cursor = 'pointer';
                    
                    const icons = ['fas fa-user-lock', 'fas fa-cart-shopping', 'fas fa-magnifying-glass', 
                                   'fas fa-envelope', 'fas fa-cogs', 'fas fa-chart-line', 'fas fa-bell', 'fas fa-gear'];
                    const icon = icons[index % icons.length];
                    
                    tag.innerHTML = `
                        <i class="fas ${icon}"></i>
                        <span>${feature.name}</span>
                    `;
                    tag.onclick = (e) => {
                        // Try to load from localStorage first
                        const cached = loadTestCasesFromCache(feature.name);
                        if (cached) {
                            displayTestCases(cached, feature.name);
                        } else {
                            generateTestCases(feature.name, feature.description, url, e.target);
                        }
                    };
                    leftContainer.appendChild(tag);
                });
            }

            // Find or create container for test items in right column
            let container = document.querySelector('.ai-test-items');
            
            if (!container) {
                // Create new container in the right-col
                const rightCol = document.querySelector('.right-col');
                if (!rightCol) {
                    console.error('Right column not found');
                    alert('‚ùå Kh√¥ng t√¨m th·∫•y container ph√π h·ª£p');
                    return;
                }

                // Create a new card for features
                container = document.createElement('div');
                container.className = 'card ai-test-items';
                container.style.marginTop = '2rem';
                
                const header = document.createElement('div');
                header.className = 'card-header';
                header.innerHTML = `
                    <h2>
                        <i class="fas fa-magic"></i>
                        C√°c ch·ª©c nƒÉng ph√°t hi·ªán ƒë∆∞·ª£c
                    </h2>
                `;
                container.appendChild(header);
                rightCol.appendChild(container);
            }

            // Clear existing feature items (but keep header)
            const items = container.querySelectorAll('.ai-test-item');
            items.forEach(item => item.remove());

            if (!features || features.length === 0) {
                const msg = document.createElement('p');
                msg.style.cssText = 'text-align: center; color: #999;';
                msg.textContent = 'Kh√¥ng t√¨m th·∫•y ch·ª©c nƒÉng';
                container.appendChild(msg);
                return;
            }

            // Add feature cards
            features.forEach((feature, index) => {
                const featureCard = document.createElement('div');
                featureCard.className = 'ai-test-item';
                featureCard.style.cursor = 'pointer';
                featureCard.innerHTML = `
                    <span class="ai-badge">Feature ${index + 1}</span>
                    <h3>${feature.name}</h3>
                    <p>${feature.description}</p>
                    <p style="font-size: 0.9rem; color: #888; margin-top: 0.5rem;">
                        <strong>Priority:</strong> ${feature.priority}
                    </p>
                    <button class="btn-run" onclick="generateTestCases('${feature.name.replace(/'/g, "\\'")}', '${feature.description.replace(/'/g, "\\'")}', '${url}', this)">
                        <i class="fas fa-magic"></i> T·∫°o Test Cases
                    </button>
                `;
                container.appendChild(featureCard);
            });
        }

        async function generateTestCases(featureName, featureDescription, url, targetElement) {
            console.log(`Generating test cases for: ${featureName}`);

            // Find the button if targetElement is provided
            let btn = null;
            if (targetElement) {
                btn = targetElement.closest('button') || (targetElement.tagName === 'BUTTON' ? targetElement : null);
            }
            
            const originalHTML = btn ? btn.innerHTML : '';
            if (btn) {
                btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ƒêang t·∫°o...';
                btn.disabled = true;
            }

            try {
                console.log(`Fetching from: ${API_URL}/api/generate-tests-for-feature`);
                const response = await fetch(`${API_URL}/api/generate-tests-for-feature`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        url,
                        feature: featureName,
                        featureDescription
                    })
                });

                console.log('Response status:', response.status);
                console.log('Response ok:', response.ok);

                // Check if response is OK first
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('Error response text:', errorText);
                    throw new Error(`HTTP ${response.status}: ${errorText.substring(0, 200)}`);
                }

                // Now parse JSON safely
                let data;
                try {
                    data = await response.json();
                } catch (parseError) {
                    console.error('Failed to parse JSON:', parseError);
                    const responseText = await response.text();
                    console.error('Response text:', responseText);
                    throw new Error(`Invalid JSON response: ${responseText.substring(0, 100)}`);
                }

                console.log('Generated test cases:', data);

                if (!data.testCases) {
                    throw new Error('No testCases in response');
                }

                // Save to localStorage
                saveTestCasesToCache(featureName, data.testCases);
                
                // Display test cases in right column
                displayTestCases(data.testCases, featureName);
                
            } catch (error) {
                console.error('Error:', error);
                alert('‚ùå L·ªói t·∫°o test cases: ' + error.message);
            } finally {
                if (btn) {
                    btn.innerHTML = originalHTML;
                    btn.disabled = false;
                }
            }
        }

        function saveTestCasesToCache(featureName, testCases) {
            try {
                const cacheKey = `testcases_${featureName.replace(/\s+/g, '_')}`;
                localStorage.setItem(cacheKey, JSON.stringify(testCases));
                console.log(`‚úÖ Test cases saved to cache: ${cacheKey}`);
            } catch (error) {
                console.warn('Failed to save to localStorage:', error);
            }
        }

        function loadTestCasesFromCache(featureName) {
            try {
                const cacheKey = `testcases_${featureName.replace(/\s+/g, '_')}`;
                const cached = localStorage.getItem(cacheKey);
                if (cached) {
                    console.log(`‚úÖ Test cases loaded from cache: ${cacheKey}`);
                    return JSON.parse(cached);
                }
            } catch (error) {
                console.warn('Failed to load from localStorage:', error);
            }
            return null;
        }

        function displayTestCases(testCases, featureName) {
            // Store current feature name for creating new test cases
            localStorage.setItem('currentSelectedFeature', featureName);

            // Get AI tests tab container
            let container = document.getElementById('aiTestsTab');
            if (!container) return;

            // Clear previous content
            container.innerHTML = '';

            // Create test cases container
            const wrapper = document.createElement('div');
            wrapper.className = 'card';
            wrapper.style.marginTop = '0';

            const header = document.createElement('div');
            header.className = 'card-header';
            header.innerHTML = `
                <h2>
                    <i class="fas fa-vial"></i>
                    Test Cases cho "${featureName}"
                </h2>
                <button class="btn-run" onclick="runAllTestCases(this)" style="background: #52b788;">
                    <i class="fas fa-play"></i> Ch·∫°y t·∫•t c·∫£
                </button>
            `;
            wrapper.appendChild(header);

            if (!testCases || testCases.length === 0) {
                const msg = document.createElement('p');
                msg.style.cssText = 'text-align: center; color: #999; padding: 2rem;';
                msg.textContent = 'Kh√¥ng c√≥ test cases';
                wrapper.appendChild(msg);
                container.appendChild(wrapper);
                return;
            }

            // Add test case items
            testCases.forEach((testCase, index) => {
                const testItem = document.createElement('div');
                testItem.className = 'ai-test-item';
                testItem.style.marginBottom = '1rem';
                testItem.style.borderLeft = '4px solid #52b788';
                testItem.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <div style="flex: 1;">
                            <span class="ai-badge" style="background: #52b788;">Test ${index + 1}</span>
                            <h4 style="margin: 0.5rem 0; color: #1b4332;">${testCase.name}</h4>
                            <p style="margin: 0.3rem 0; font-size: 0.9rem;">${testCase.description}</p>
                            <p style="margin: 0.3rem 0; font-size: 0.85rem; color: #666;">
                                <strong>Priority:</strong> ${testCase.priority}
                            </p>
                            <details style="margin-top: 0.5rem; cursor: pointer;">
                                <summary style="color: #52b788; font-weight: 500;">üìã Steps (${testCase.steps ? testCase.steps.length : 0})</summary>
                                <div style="background: #f0f9ff; padding: 0.5rem; margin-top: 0.5rem; border-radius: 4px; font-size: 0.85rem;">
                                    ${testCase.steps ? testCase.steps.map((step, i) => `<div style="margin: 0.3rem 0;">‚úì ${step}</div>`).join('') : 'N/A'}
                                </div>
                            </details>
                            <p style="margin: 0.5rem 0 0 0; font-size: 0.85rem; color: #333;">
                                <strong>Expected:</strong> ${testCase.expectedResult}
                            </p>
                        </div>
                        <button class="btn-run" onclick="runSingleTest(this, '${testCase.name}')" style="white-space: nowrap; margin-left: 1rem; background: #40916c;">
                            <i class="fas fa-play"></i> Run
                        </button>
                    </div>
                    <div class="test-result" style="display: none; margin-top: 0.5rem; padding: 0.5rem; border-radius: 4px; font-size: 0.9rem;"></div>
                `;
                wrapper.appendChild(testItem);
            });

            container.appendChild(wrapper);
            switchTab('ai-tests');
        }

        function runSingleTest(btn, testName) {
            const resultDiv = btn.closest('.ai-test-item').querySelector('.test-result');
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ch·∫°y...';
            btn.disabled = true;

            // Simulate test execution (1-2 second delay)
            setTimeout(() => {
                const passed = Math.random() > 0.3; // 70% pass rate for demo
                resultDiv.style.display = 'block';
                resultDiv.style.background = passed ? '#d4edda' : '#f8d7da';
                resultDiv.style.color = passed ? '#155724' : '#721c24';
                resultDiv.style.border = `1px solid ${passed ? '#c3e6cb' : '#f5c6cb'}`;
                resultDiv.innerHTML = `
                    <strong>${passed ? '‚úÖ PASS' : '‚ùå FAIL'}</strong> - ${testName}
                    ${!passed ? '<br>Error: Element not found or assertion failed' : ''}
                `;
                btn.innerHTML = '<i class="fas fa-play"></i> Run';
                btn.disabled = false;
            }, 1500);
        }

        function runAllTestCases(btn) {
            const testItems = btn.closest('.card').querySelectorAll('.ai-test-item');
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ch·∫°y t·∫•t c·∫£...';
            btn.disabled = true;

            let completed = 0;
            testItems.forEach(item => {
                const runBtn = item.querySelector('.btn-run');
                runBtn.click();
                setTimeout(() => {
                    completed++;
                    if (completed === testItems.length) {
                        btn.innerHTML = '<i class="fas fa-play"></i> Ch·∫°y t·∫•t c·∫£';
                        btn.disabled = false;
                    }
                }, 1500 * (completed + 1));
            });
        }

        function runAllTests() {
            console.log('Running all tests');
            alert('Ch·ª©c nƒÉng n√†y s·∫Ω ch·∫°y to√†n b·ªô test cases');
        }

        function exportTests() {
            console.log('Exporting tests');
            alert('Ch·ª©c nƒÉng n√†y s·∫Ω export to√†n b·ªô test cases');
        }
    </script>

    <!-- CREATE TEST CASE MODAL -->
    <div id="createTestCaseModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>
                    <i class="fas fa-plus-circle"></i>
                    T·∫°o Test Case M·ªõi
                </h2>
                <button class="modal-close" onclick="closeCreateTestCaseModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <form id="createTestCaseForm" onsubmit="submitCreateTestCase(event)">
                <div class="form-group">
                    <label for="testCaseName">T√™n Test Case <span style="color: red;">*</span></label>
                    <input type="text" id="testCaseName" name="testCaseName" placeholder="V√≠ d·ª•: Test ƒëƒÉng nh·∫≠p th√†nh c√¥ng" required>
                </div>

                <div class="form-group">
                    <label for="testCaseDescription">M√¥ t·∫£ <span style="color: red;">*</span></label>
                    <textarea id="testCaseDescription" name="testCaseDescription" placeholder="M√¥ t·∫£ chi ti·∫øt v·ªÅ test case n√†y" required></textarea>
                </div>

                <div class="form-group">
                    <label for="testCasePriority">M·ª©c ƒë·ªô ∆∞u ti√™n</label>
                    <select id="testCasePriority" name="testCasePriority">
                        <option value="Low">Th·∫•p (Low)</option>
                        <option value="Medium" selected>Trung b√¨nh (Medium)</option>
                        <option value="High">Cao (High)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="testCaseSteps">C√°c b∆∞·ªõc th·ª±c hi·ªán (m·ªói d√≤ng m·ªôt b∆∞·ªõc)</label>
                    <textarea id="testCaseSteps" name="testCaseSteps" placeholder="B∆∞·ªõc 1&#10;B∆∞·ªõc 2&#10;B∆∞·ªõc 3"></textarea>
                </div>

                <div class="form-group">
                    <label for="testCaseExpected">K·∫øt qu·∫£ mong ƒë·ª£i <span style="color: red;">*</span></label>
                    <textarea id="testCaseExpected" name="testCaseExpected" placeholder="M√¥ t·∫£ k·∫øt qu·∫£ d·ª± ki·∫øn sau khi test" required></textarea>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn-cancel" onclick="closeCreateTestCaseModal()">
                        <i class="fas fa-times"></i> H·ªßy
                    </button>
                    <button type="submit" class="btn-submit">
                        <i class="fas fa-check"></i> T·∫°o Test Case
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        function openCreateTestCaseModal() {
            document.getElementById('createTestCaseModal').classList.add('active');
            document.getElementById('createTestCaseForm').reset();
        }

        function closeCreateTestCaseModal() {
            document.getElementById('createTestCaseModal').classList.remove('active');
        }

        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));

            // Show selected tab
            if (tabName === 'ai-tests') {
                document.getElementById('aiTestsTab').classList.add('active');
                document.querySelector('.tab-button:nth-child(1)').classList.add('active');
            } else if (tabName === 'custom-tests') {
                document.getElementById('customTestsTab').classList.add('active');
                document.querySelector('.tab-button:nth-child(2)').classList.add('active');
                // Refresh custom tests display
                displayCustomTests();
            }
        }

        function displayCustomTests() {
            const customTestsContainer = document.getElementById('customTestsContainer');
            const customTests = localStorage.getItem('customTestCases');
            
            if (!customTests) {
                customTestsContainer.innerHTML = '<p style="text-align: center; color: #999; padding: 2rem 0;">T·∫°o test case m·ªõi ƒë·ªÉ b·∫Øt ƒë·∫ßu</p>';
                return;
            }

            const tests = JSON.parse(customTests);
            if (tests.length === 0) {
                customTestsContainer.innerHTML = '<p style="text-align: center; color: #999; padding: 2rem 0;">T·∫°o test case m·ªõi ƒë·ªÉ b·∫Øt ƒë·∫ßu</p>';
                return;
            }

            customTestsContainer.innerHTML = '';
            tests.forEach((testCase, index) => {
                const testItem = document.createElement('div');
                testItem.className = 'ai-test-item';
                testItem.style.marginBottom = '1rem';
                testItem.style.borderLeft = '4px solid #40916c';
                testItem.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <div style="flex: 1;">
                            <span class="ai-badge" style="background: #40916c;">Custom ${index + 1}</span>
                            <h4 style="margin: 0.5rem 0; color: #1b4332;">${testCase.name}</h4>
                            <p style="margin: 0.3rem 0; font-size: 0.9rem;">${testCase.description}</p>
                            <p style="margin: 0.3rem 0; font-size: 0.85rem; color: #666;">
                                <strong>Priority:</strong> ${testCase.priority}
                            </p>
                            <details style="margin-top: 0.5rem; cursor: pointer;">
                                <summary style="color: #40916c; font-weight: 500;">üìã Steps (${testCase.steps ? testCase.steps.length : 0})</summary>
                                <div style="background: #f0f9ff; padding: 0.5rem; margin-top: 0.5rem; border-radius: 4px; font-size: 0.85rem;">
                                    ${testCase.steps ? testCase.steps.map((step, i) => `<div style="margin: 0.3rem 0;">‚úì ${step}</div>`).join('') : 'N/A'}
                                </div>
                            </details>
                            <p style="margin: 0.5rem 0 0 0; font-size: 0.85rem; color: #333;">
                                <strong>Expected:</strong> ${testCase.expectedResult}
                            </p>
                        </div>
                        <button class="btn-run" onclick="deleteCustomTest(${testCase.id})" style="white-space: nowrap; margin-left: 1rem; background: #ef4444; color: white;">
                            <i class="fas fa-trash"></i> X√≥a
                        </button>
                    </div>
                `;
                customTestsContainer.appendChild(testItem);
            });
        }

        function deleteCustomTest(testId) {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a test case n√†y?')) {
                const customTests = localStorage.getItem('customTestCases');
                if (customTests) {
                    let tests = JSON.parse(customTests);
                    tests = tests.filter(t => t.id !== testId);
                    if (tests.length > 0) {
                        localStorage.setItem('customTestCases', JSON.stringify(tests));
                    } else {
                        localStorage.removeItem('customTestCases');
                    }
                    displayCustomTests();
                    updateCustomTestCount();
                }
            }
        }

        function updateCustomTestCount() {
            const customTests = localStorage.getItem('customTestCases');
            const count = customTests ? JSON.parse(customTests).length : 0;
            document.getElementById('customTestCount').textContent = count;
        }

        async function optimizeCustomTests() {
            const customTests = localStorage.getItem('customTestCases');
            if (!customTests) {
                alert('‚ùå Kh√¥ng c√≥ test case n√†o ƒë·ªÉ t·ªëi ∆∞u');
                return;
            }

            const tests = JSON.parse(customTests);
            const btn = event.target.closest('button');
            const originalHTML = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ƒêang t·ªëi ∆∞u...';
            btn.disabled = true;

            try {
                // Format test cases for AI
                const testSummary = tests.map(t => `- ${t.name}: ${t.description}`).join('\n');
                
                const response = await fetch(`${API_URL}/api/review-test-script`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        code: testSummary,
                        language: 'test-description'
                    })
                });

                if (!response.ok) {
                    throw new Error('Failed to optimize tests');
                }

                const data = await response.json();
                alert('‚úÖ AI ƒë√£ t·ªëi ∆∞u! Ki·ªÉm tra console ƒë·ªÉ xem g·ª£i √Ω');
                console.log('ü§ñ AI Optimization Suggestions:', data);
                
            } catch (error) {
                console.error('Error:', error);
                alert('‚ùå L·ªói: ' + error.message);
            } finally {
                btn.innerHTML = originalHTML;
                btn.disabled = false;
            }
        }

        function submitCreateTestCase(event) {
            event.preventDefault();

            const name = document.getElementById('testCaseName').value.trim();
            const description = document.getElementById('testCaseDescription').value.trim();
            const priority = document.getElementById('testCasePriority').value;
            const stepsText = document.getElementById('testCaseSteps').value.trim();
            const expectedResult = document.getElementById('testCaseExpected').value.trim();

            if (!name || !description || !expectedResult) {
                alert('‚ùå Vui l√≤ng ƒëi·ªÅn c√°c tr∆∞·ªùng b·∫Øt bu·ªôc');
                return;
            }

            // Parse steps from text
            const steps = stepsText
                ? stepsText.split('\n').map(s => s.trim()).filter(s => s.length > 0)
                : [];

            // Create test case object
            const testCase = {
                id: Date.now(),
                name: name,
                description: description,
                priority: priority,
                steps: steps,
                expectedResult: expectedResult
            };

            console.log('Created test case:', testCase);

            // Get existing custom test cases
            let customTestCases = localStorage.getItem('customTestCases');
            let allCustomTests = customTestCases ? JSON.parse(customTestCases) : [];
            
            // Add new test case
            allCustomTests.push(testCase);

            // Save back to localStorage
            localStorage.setItem('customTestCases', JSON.stringify(allCustomTests));

            // Close modal
            closeCreateTestCaseModal();

            // Show success message
            alert('‚úÖ Test Case ƒë∆∞·ª£c t·∫°o th√†nh c√¥ng!');

            // Refresh displays
            updateCustomTestCount();
            displayCustomTests();
            
            // Show custom tests tab
            document.getElementById('testTabsContainer').style.display = 'flex';
            switchTab('custom-tests');
        }

        // Close modal when clicking outside
        document.getElementById('createTestCaseModal')?.addEventListener('click', function(e) {
            if (e.target === this) {
                closeCreateTestCaseModal();
            }
        });

        // Initialize custom test count on page load
        window.addEventListener('load', () => {
            updateCustomTestCount();
        });
    </script>
</body>
</html>
